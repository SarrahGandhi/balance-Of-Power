<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Balance of Power</title>
  <link rel="stylesheet" href="./css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@600&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Baskervville+SC&display=swap" rel="stylesheet">



</head>
<body>
    <header class="nav">
        <div class="hamburger">
            <div></div>
            <div></div>
            <div></div>
        </div>
        <nav>
            <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#instructions">Instructions</a></li>
            <li><a href="solve.html">Solve</a></li>
            </ul>
        </nav>
    </header>
  <main class="chapter-sort-page">
    <h1 class="title">BALANCE OF POWER</h1>

    <div class="chapter-container" id="chapterContainer">
      <div class="chapter" draggable="true" data-id="1">
        <img src="images/chap_1.png" alt="Chapter 1">
      </div>
      <div class="chapter" draggable="true" data-id="2">
        <img src="images/chap_2.png" alt="Chapter 2">
      </div>
      <div class="chapter" draggable="true" data-id="3">
        <img src="images/chap_3.png" alt="Chapter 3">
      </div>
    </div>
    <button class="submit-btn" id="submitOrder">SUBMIT</button>
</main>

<div id="wrongOrderPopup" class="popup-overlay">
    <div class="popup-box">
      <p>
        <strong>Your timeline doesn't align.</strong><br>
        Memories must fall into place — the truth only surfaces in the right order.<br>
        Re-evaluate the evidence, and try again.
      </p>
      <button id="closeWrongOrderPopup">CLOSE</button>
    </div>
  </div>

  <div id="successPopup" class="popup-overlay">
    <div class="popup-box">
      <p>
        All good
      </p>
      <button id="closesuccessOrderPopup">CLOSE</button>
    </div>
  </div>
  <!--<script>
    const container = document.getElementById('chapterContainer');
    const wrongPopup = document.getElementById('wrongOrderPopup');
    const closeWrongPopup = document.getElementById('closeWrongOrderPopup');
  
    let draggedItem = null;
  
    container.addEventListener('dragstart', (e) => {
      draggedItem = e.target.closest('.chapter');
      draggedItem.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    });
  
    container.addEventListener('dragend', () => {
      if (draggedItem) {
        draggedItem.classList.remove('dragging');
        draggedItem = null;
      }
    });
  
    container.addEventListener('dragover', (e) => {
      e.preventDefault();
      const afterElement = getDragAfterElement(container, e.clientX);
      const current = document.querySelector('.dragging');
      if (afterElement == null) {
        container.appendChild(current);
      } else {
        container.insertBefore(current, afterElement);
      }
    });
  
    function getDragAfterElement(container, x) {
      const elements = [...container.querySelectorAll('.chapter:not(.dragging)')];
      return elements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = x - box.left - box.width / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
  
    document.getElementById('submitOrder').addEventListener('click', () => {
      const currentOrder = Array.from(container.querySelectorAll('.chapter')).map(el => el.dataset.id);
      const correctOrder = ['3', '1', '2'];
  
      if (JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) {
        alert("You have matched all the chapters correctly!");
      } else {
        wrongPopup.style.display = "flex";
      }
    });
  
    closeWrongPopup.addEventListener('click', () => {
      wrongPopup.style.display = "none";
    });
  </script>-->
  <script>
    let selectedOrder = [];

document.querySelectorAll('.chapter').forEach((chapter) => {
  chapter.addEventListener('click', () => {
    const id = chapter.dataset.id;

    // If already selected and is the last selected, unselect it
    if (selectedOrder.includes(id)) {
      if (selectedOrder[selectedOrder.length - 1] === id) {
        selectedOrder.pop(); // remove last
        chapter.classList.remove('selected');

        const label = chapter.querySelector('.order-label');
        if (label) chapter.removeChild(label);
        return;
      } else {
        // Prevent unselecting if not the last one clicked
        alert("You can only unselect the last selected chapter.");
        return;
      }
    }

    // Otherwise, select it
    selectedOrder.push(id);
    chapter.classList.add('selected');

    const orderLabel = document.createElement('span');
    orderLabel.className = 'order-label';
    orderLabel.textContent = selectedOrder.length;
    chapter.appendChild(orderLabel);
  });
});

document.getElementById("submitOrder").addEventListener("click", () => {
  const correctOrder = ["3", "1", "2"];

  if (selectedOrder.length !== correctOrder.length) {
    alert("❌ Please select all chapters in order before submitting.");
    return;
  }

  // Compare each item one by one for full control
  let isCorrect = true;
  for (let i = 0; i < correctOrder.length; i++) {
    if (selectedOrder[i] !== correctOrder[i]) {
      isCorrect = false;
      break;
    }
  }

  if (isCorrect) {
    document.getElementById("successPopup").style.display = "flex";
  } else {
    document.getElementById("wrongOrderPopup").style.display = "flex";
  }
});

document.getElementById("closeWrongOrderPopup").addEventListener("click", () => {
  document.getElementById("wrongOrderPopup").style.display = "none";

  // Reset selection
  selectedOrder = [];
  document.querySelectorAll('.chapter').forEach((chapter) => {
    chapter.classList.remove('selected');
    const label = chapter.querySelector('.order-label');
    if (label) chapter.removeChild(label);
  });
});



document.getElementById("closesuccessOrderPopup").addEventListener("click", () => {
  document.getElementById("successPopup").style.display = "none";

  // Reset selection
  selectedOrder = [];
  document.querySelectorAll('.chapter').forEach((chapter) => {
    chapter.classList.remove('selected');
    const label = chapter.querySelector('.order-label');
    if (label) chapter.removeChild(label);
  });
});


  </script>
</body>
</html>
